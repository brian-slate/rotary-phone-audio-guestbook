{% extends "base.html" %}
{% block title %}BLACK BOX - Recordings{% endblock %}
{% block extra_head %}
<script src="{{ url_for('static', filename='js/moment.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/hammer.min.js') }}"></script>
{% endblock %}
{% block content %}
<h1 class="text-3xl font-bold text-center mb-8">Available Recordings</h1>

<!-- Search and Filter Controls -->
<div class="mb-4 bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
  <!-- Mobile: Search + Toggle -->
  <div class="md:hidden space-y-3">
    <div class="flex gap-2">
      <div class="flex-1 relative">
        <input type="text" id="search-input" placeholder="Search recordings..." 
               class="w-full px-3 py-2 pr-10 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <button id="clear-search-mobile" class="hidden absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
          <i class="fas fa-times text-sm"></i>
        </button>
      </div>
      <button id="toggle-filters-mobile" class="px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
        <i class="fas fa-filter"></i>
      </button>
    </div>
    <div id="mobile-filters" class="hidden space-y-2">
      <select id="search-field" class="w-full px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500">
        <option value="title">Search in: Title</option>
        <option value="transcript">Search in: Transcript</option>
        <option value="both">Search in: Both</option>
      </select>
      <select id="filter-speaker" class="w-full px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500">
        <option value="">All Speakers</option>
      </select>
      <select id="filter-category" class="w-full px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500">
        <option value="">All Categories</option>
        <option value="joyful">Joyful</option>
        <option value="heartfelt">Heartfelt</option>
        <option value="humorous">Humorous</option>
        <option value="nostalgic">Nostalgic</option>
        <option value="advice">Advice</option>
        <option value="blessing">Blessing</option>
        <option value="toast">Toast</option>
        <option value="gratitude">Gratitude</option>
        <option value="apology">Apology</option>
        <option value="well-wishes">Well Wishes</option>
        <option value="playful">Playful</option>
        <option value="introduction">Introduction</option>
        <option value="announcement">Announcement</option>
      </select>
    </div>
  </div>
  
  <!-- Tablet (md): Search + Field on top, Speakers/Category below -->
  <div class="hidden md:flex lg:hidden flex-col gap-2">
    <div class="flex gap-2">
      <div class="flex-1 relative">
        <input type="text" id="search-input-md" placeholder="Search recordings..." 
               class="w-full px-3 py-2 pr-10 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <button id="clear-search-md" class="hidden absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
          <i class="fas fa-times text-sm"></i>
        </button>
      </div>
      <select id="search-field-md" class="px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 whitespace-nowrap">
        <option value="title">Title</option>
        <option value="transcript">Transcript</option>
        <option value="both">Both</option>
      </select>
    </div>
    <div class="flex gap-2">
      <select id="filter-speaker-md" class="flex-1 px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500">
        <option value="">All Speakers</option>
      </select>
      <select id="filter-category-md" class="flex-1 px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500">
        <option value="">All Categories</option>
        <option value="joyful">Joyful</option>
        <option value="heartfelt">Heartfelt</option>
        <option value="humorous">Humorous</option>
        <option value="nostalgic">Nostalgic</option>
        <option value="advice">Advice</option>
        <option value="blessing">Blessing</option>
        <option value="toast">Toast</option>
        <option value="gratitude">Gratitude</option>
        <option value="apology">Apology</option>
        <option value="well-wishes">Well Wishes</option>
        <option value="playful">Playful</option>
        <option value="introduction">Introduction</option>
        <option value="announcement">Announcement</option>
      </select>
      <button id="clear-filters-md" class="px-3 py-2 text-sm rounded-md bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors whitespace-nowrap">
        <i class="fas fa-undo text-xs"></i>
      </button>
    </div>
  </div>
  
  <!-- Desktop (lg+): All in one row, icon-only reset -->
  <div class="hidden lg:flex gap-2">
    <div class="flex-1 relative">
      <input type="text" id="search-input-lg" placeholder="Search recordings..." 
             class="w-full px-3 py-2 pr-10 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      <button id="clear-search-lg" class="hidden absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
        <i class="fas fa-times text-sm"></i>
      </button>
    </div>
    <select id="search-field-lg" class="px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500">
      <option value="title">Title</option>
      <option value="transcript">Transcript</option>
      <option value="both">Both</option>
    </select>
    <select id="filter-speaker-lg" class="px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500">
      <option value="">All Speakers</option>
    </select>
    <select id="filter-category-lg" class="px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500">
      <option value="">All Categories</option>
      <option value="joyful">Joyful</option>
      <option value="heartfelt">Heartfelt</option>
      <option value="humorous">Humorous</option>
      <option value="nostalgic">Nostalgic</option>
      <option value="advice">Advice</option>
      <option value="blessing">Blessing</option>
      <option value="toast">Toast</option>
      <option value="gratitude">Gratitude</option>
      <option value="apology">Apology</option>
      <option value="well-wishes">Well Wishes</option>
      <option value="playful">Playful</option>
      <option value="introduction">Introduction</option>
      <option value="announcement">Announcement</option>
    </select>
    <button id="clear-filters-lg" class="px-3 py-2 text-sm rounded-md bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors" title="Reset filters">
      <i class="fas fa-undo text-xs"></i>
    </button>
  </div>
</div>

<div class="flex flex-wrap justify-between items-center mb-6 gap-2 sm:gap-4">
  <div id="results-count" class="text-sm text-gray-600 dark:text-gray-400"></div>
  <div class="flex gap-2">
    <button id="download-selected" aria-label="Download Selected" class="bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-md w-10 h-10 p-0 inline-flex items-center justify-center shadow-sm transition-colors duration-200 md:w-auto md:h-auto md:px-4 md:py-2">
      <i class="fas fa-download text-lg md:mr-2"></i><span class="hidden md:inline">Download Selected</span>
    </button>
    <button id="delete-selected" aria-label="Delete Selected" class="bg-red-500 hover:bg-red-600 text-white font-medium rounded-md w-10 h-10 p-0 inline-flex items-center justify-center shadow-sm transition-colors duration-200 md:w-auto md:h-auto md:px-4 md:py-2">
      <i class="fas fa-trash-alt text-lg md:mr-2"></i><span class="hidden md:inline">Delete Selected</span>
    </button>
  </div>
</div>

<div class="overflow-x-auto">
  <table class="w-full">
    <thead>
      <tr class="bg-primary dark:bg-dark-primary text-text dark:text-dark-text rounded-t-lg overflow-hidden">
        <th class="p-3 w-12 text-center">
          <input type="checkbox" id="select-all" class="w-4 h-4" />
        </th>
        <th class="p-3 text-left font-semibold">Message</th>
        <th class="p-3 text-left font-semibold hidden md:table-cell">Audio</th>
        <th class="p-3 text-left font-semibold hidden sm:table-cell">Date</th>
        <th class="p-3 w-24 text-right font-semibold hidden sm:table-cell">Actions</th>
      </tr>
    </thead>
    <tbody id="recording-list" class="divide-y divide-gray-200 dark:divide-gray-700">
      <!-- Recordings will be dynamically inserted here -->
    </tbody>
  </table>
</div>
{% endblock %}
{% block extra_js %}
<script src="{{ url_for('static', filename='js/recordings.js') }}"></script>
{% endblock %}